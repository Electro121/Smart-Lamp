<!DOCTYPE html>
<html lang="en">
    <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>My Webpage</title>
    <style>
        .head {
            font-family: Arial, sans-serif;
            background-color: #3498db;
            color: #fff;
            text-align: center;
            padding: 1em 0;
            border-radius: 10px;
        }
        .heaf {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 30px;
            color: rgb(0, 0, 0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1em;
            background-color: #ffffff;
            border: 8px;
            font-size: 28px;
            border-radius: 8px;
            margin-left: 50px;
            margin-right: 50px;
        }
        #ok {
            text-align: center;
            margin-top: 50px;
            border-radius: 10px;
        }
        #button {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
        }
        #btn {
            cursor: pointer;
        }

        .power-button {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        #power-btn {
            cursor: pointer;
            padding: 10px 20px;
            background-color: #d62830;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        /*#power-btn:hover {
            background-color: #2980b9;
        }*/
        
        footer {
            color: black;
            font-size: smaller;
            margin-bottom: 0;
        }
    </style>
    </head>
    <body>
        <div class="head">
            <h1>Smart Light Control</h1>
        </div>
        <section class="heaf">
            <p2 id="ok"><strong>Light Status:</strong></p2>
            <span id="key">OFF</span>
        <div id="button">
            <i id="btn" class="fa-regular fa-lightbulb fa-8x" type="button"></i>
        </div>
        </section>
        <div class="power-button">
            <button id="power-btn" class="p2btn" type="button">Power Off</button>
        </div>
        <footer>
            <p id="footer">&copy; RS63 Robotics Group-5 All rights reserved.</p>
        </footer>
    </body>
    <script>
        
        var gateway = `ws://esp.local/ws`;
        var websocket;
        // Init web socket when the page loads
        window.addEventListener('load', onload);

        function onload(event) {
            initWebSocket();
        }

        function initWebSocket() {
            console.log('Trying to open a WebSocket connectionâ€¦');
            websocket = new WebSocket(gateway);
            websocket.onopen = onOpen;
            websocket.onclose = onClose;
            websocket.onmessage = onMessage;
        }

        // When websocket is established, call the getReadings() function
        function onOpen(event) {
            console.log('Connection opened');
        }

        function onClose(event) {
            console.log('Connection closed');
            setTimeout(initWebSocket, 2000);
        }
        let dt;
        function onMessage(event) {
            console.log(event.data);
            dt = event.data
           // btxt.innerHTML = dt;
           handleText();
        }
        let clicked = false
        const bnt = document.getElementById("btn");
        const btxt = document.getElementById("key");
        btn.addEventListener('click', function(e) {
            if(clicked == false) {
                clicked = true;
                websocket.send("clicked");
            } else {
                clicked = false;
                websocket.send("rclicked");
            }
        });
        
        function handleText() {
            if(dt== "1") {
                btxt.textContent = "ON";
                bnt.classList.replace("fa-regular", "fa-solid");
            }
            else {
                btxt.textContent = "OFF";
                bnt.classList.replace("fa-solid", "fa-regular");
            }
        }

        const pBtn = document.getElementById("power-btn");
        let pressed = false;
        pBtn.addEventListener('click', function(e) {
            if(pressed == false) {
                        pressed = true;
                        console.log("Button has been clicked");
                        pBtn.innerHTML = "Power On";
                        pBtn.style.backgroundColor = '#1bc531';
                        websocket.send('on');

                } else {
                    pressed = false;
                    pBtn.innerHTML = "Power Off";
                    pBtn.style.backgroundColor = '#d62830';
                    websocket.send('off');
                }
        });

    </script>
</html>
